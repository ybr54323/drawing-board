var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,n=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,r=(e,n,s)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,i=(t,i)=>{for(var a in i||(i={}))e.call(i,a)&&r(t,a,i[a]);if(n)for(var a of n(i))s.call(i,a)&&r(t,a,i[a]);return t};import{C as a,B as o,M as c,N as h,a as d}from"./vendor.80c400cb.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(n){const s=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((n,i)=>{const a=new URL(t,s);if(self[e].moduleMap[a])return n(self[e].moduleMap[a]);const o=new Blob([`import * as m from '${a}';`,`${e}.moduleMap['${a}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){i(new Error(`Failed to import: ${t}`)),r(c)},onload(){n(self[e].moduleMap[a]),r(c)}});document.head.appendChild(c)})),self[e].moduleMap={}}}("assets/");var l="_outerCon_15jfw_1",u=a.forwardRef((function(t,e){return a.createElement("div",{className:l,ref:e},"ref")}));var E="_button_1uaa0_1",m="_input_1uaa0_13";function f(t){const e=a.useRef({}),{handleInputChange:n}=t;return a.createElement("div",null,a.createElement(o,{className:E,onClick:function(){e.current.click()}},a.createElement("svg",{t:"1619934189509",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1220",width:"16",height:"16"},a.createElement("path",{d:"M824.888889 297.528889H551.253333l-113.777777-98.417778H199.111111a56.888889 56.888889 0 0 0-56.888889 56.888889v512a56.888889 56.888889 0 0 0 56.888889 56.888889h625.777778a56.888889 56.888889 0 0 0 56.888889-56.888889V354.417778a56.888889 56.888889 0 0 0-56.888889-56.888889zM416.426667 256L512 341.333333l15.928889 13.653334h296.96v192.284444h-625.777778V256z","p-id":"1221",fill:"#1296db"})),"选择文件"),a.createElement("input",{type:"file",className:m,ref:e,accept:"image/png,image/jpeg,image/gif",onChange:n}))}var g="_canvas_1wlp8_1",T=a.forwardRef((function(t,e){const{style:n,onMouseMove:s,onMouseDown:r,onMouseUp:i}=t;return a.createElement("canvas",{id:"canvas",ref:e,className:g,onTouchStart:r,onTouchMove:s,onTouchEnd:i,onMouseMove:s,onMouseDown:r,onMouseUp:i,style:n})}));var p="_infoCardCon_uirom_1",_="_colorChunk_uirom_25";function S(t){const{position:{x:e,y:n,colorArrayData:s}}=t,r={transform:"translate3d(0,0,0)",top:n+"px",left:e+"px",display:(null==s?void 0:s.length)>0?"flex":"none"},i=s.slice(0,4).reduce((function(t,e){return t+e.toString(16)}),"");let o={};return i&&(o.backgroundColor=`rgba(${s})`),a.createElement("div",{id:"color",className:p,style:r},i,a.createElement("span",{className:_,style:o}))}var R={con:"_con_1ko0r_1",btn:"_btn_1ko0r_13",editText:"_editText_1ko0r_23"};var w="_con_1u0oc_1";function X(t){const{style:e}=t,n=t.children.length>1?t.children:[t.children];return a.createElement("section",{className:w,style:e},n.map((function(t,e){return a.createElement("div",{key:e},t)})))}var v={con:"_con_b2u60_1",btn:"_btn_b2u60_13",btnActive:"_btnActive_b2u60_33",thin:"_thin_b2u60_41",medium:"_medium_b2u60_57",large:"_large_b2u60_73",r:"_r_b2u60_89",g:"_g_b2u60_103",b:"_b_b2u60_13"};function Y(t){const{style:{x:e,y:n,display:s,isEditingRect:r=!1,isEditingText:i=!1,isAddingMosaic:o=!1},onEditRect:c,onEditText:h,onAddMosaic:d,onChangeLineWidth:l=function(){},onChangeStrokeStyle:u=function(){}}=t,E={transform:"translate3d(0,0,0)",top:n+"px",left:e+"px",display:s};const[m,f]=a.useState(-1);return a.createElement("div",{className:v.con,style:E},a.createElement("section",null,a.createElement("div",{onClick:c,className:v.btn},r,a.createElement("svg",{t:"1619955875785",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3605",width:"16",height:"16"},a.createElement("path",{d:"M746.666667 341.333333v341.333334h-469.333334V341.333333h469.333334m68.266666-85.333333H209.066667a17.066667 17.066667 0 0 0-17.066667 17.066667v477.866666a17.066667 17.066667 0 0 0 17.066667 17.066667h605.866666a17.066667 17.066667 0 0 0 17.066667-17.066667V273.066667a17.066667 17.066667 0 0 0-17.066667-17.066667z","p-id":"3606",fill:r?"#1296db":"#fff"}))),a.createElement("div",{onClick:h,className:v.btn},a.createElement("svg",{t:"1619955335199",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3406",width:"16",height:"16"},a.createElement("path",{d:"M213.333333 209.92v128h85.333334v-42.666667h170.666666v433.493334H384.853333v85.333333h256v-85.333333H554.666667V295.253333h170.666666v42.666667h85.333334v-128H213.333333z","p-id":"3407",fill:i?"#1296db":"#fff"}))),a.createElement("div",{onClick:d,className:v.btn},a.createElement("svg",{t:"1620384304329",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1559",width:"16",height:"16"},a.createElement("path",{d:"M512 212h300v300H512zM212 512h300v300H212z",fill:"#1296db","p-id":"1560"}),a.createElement("path",{d:"M812 992H212a180 180 0 0 1-180-180V212a180 180 0 0 1 180-180h600a180 180 0 0 1 180 180v600a180 180 0 0 1-180 180zM212 152a60 60 0 0 0-60 60v600a60 60 0 0 0 60 60h600a60 60 0 0 0 60-60V212a60 60 0 0 0-60-60z",fill:o?"#1296db":"#fff","p-id":"1561"})))),r?a.createElement("section",{onClick:function(t){const e=t.target.tabIndex;if(console.log(e),e>-1&&e<3)l(e+1);else{u(3===e?"red":4===e?"green":"blue")}f(e)}},[v.thin,v.medium,v.large,v.r,v.g,v.b].map((function(t,e){return a.createElement("div",{tabIndex:e,key:e,className:[v.btn,t,m===e?v.btnActive:null].join(" ")})}))):null)}const C="TOP",I="BOTTOM",O="LEFT",b="RIGHT",y="TOP_LEFT",D="TOP_RIGHT",A="BOTTOM_LEFT",x="BOTTOM_RIGHT",N={INIT:"INIT",SCREEN_SHOT:"SCREEN_SHOT",PICK_COLOR:"PICK_COLOR",EDIT_RECT:"EDIT_RECT",EDIT_TEXT:"EDIT_TEXT",ADD_MOSAIC:"ADD_MOSAIC",WATERMARK:"WATERMARK"},M={INIT:"INIT",BEFORE_START:"BEFORE_START",STARTED:"STARTED",REGULATING:"REGULATING"};function L(t,e){if(!t instanceof HTMLCanvasElement)throw new Error("canvas error");t.getContext("2d").drawImage(e.image,0,0,t.width,t.height)}function k(t){return t?t===N.SCREEN_SHOT?"grabbing":t===N.EDIT_RECT?"crosshair":t===N.PICK_COLOR?"pointer":t===N.EDIT_TEXT?"text":[D,A].indexOf(t)>-1?"nesw-resize":[y,x].indexOf(t)>-1?"nwse-resize":[C,I].indexOf(t)>-1?"row-resize":[O,b].indexOf(t)>-1?"col-resize":"grabbing":"grabbing"}function H(t,e=100){let n=-1/0;return function(...s){const r=+Date.now();if(r-n>=e)return n=r,t.apply(this,s)}}function B(t,e,n){return t>=e-n&&t<=e+n}function U(t,e,n){return e=Math.min(e,n),n=Math.max(e,n),t>=e&&t<=n}class P{constructor({startX:t=0,startY:e=0,endX:n=0,endY:s=0,canvas:r=null}={}){Object.assign(this,{startX:t,startY:e,endX:n,endY:s,canvas:r,line:""})}setStartX(t){this.startX=t}setStartY(t){this.startY=t}setEndX(t){this.endX=t}setEndY(t){this.endY=t}setCanvas(t){this.canvas=t}getStartX(){if(this.startX===+this.startX)return this.startX;throw new Error("need startX")}getStartY(){if(this.startY===+this.startY)return this.startY;throw new Error("need startY")}getEndX(){if(this.endX===+this.endX)return this.endX;throw new Error("need endX")}getEndY(){if(this.endY===+this.endY)return this.endY;throw new Error("need endY")}getWidth(){return this.endX-this.startX}getHeight(){return this.endY-this.startY}setCurrentLine(t){this.line=t}getCurrentLine(){return this.line}setLineWidth(t){this.lineWidth=t}setStrokeStyle(t){this.strokeStyle=t}getLineWidth(){return this.lineWidth||1}getStrokeStyle(){return this.strokeStyle}getCurActiveLine(t,e){return B(t,this.endX,5)&&B(e,this.startY,5)?D:B(t,this.startX,5)&&B(e,this.startY,5)?y:B(t,this.endX,5)&&B(e,this.endY,5)?x:B(t,this.startX,5)&&B(e,this.endY,5)?A:B(e,this.startY,5)&&U(t,this.startX,this.endX)?C:B(e,this.endY,5)&&U(t,this.startX,this.endX)?I:B(t,this.startX,5)&&U(e,this.startY,this.endY)?O:B(t,this.endX,5)&&U(e,this.startY,this.endY)?b:null}mouseUpResetPos(t,e){const n=this.getCurrentLine();return n?(n===C&&this.resetTop(e),n===I&&this.resetBottom(e),n===O&&this.resetLeft(t),n===b&&this.resetRight(t),n===y&&this.resetTopLeft(t,e),n===D&&this.resetTopRight(t,e),n===A&&this.resetBottomLeft(t,e),n===x&&this.resetBottomRight(t,e),n):null}resetTop(t){t>this.endY?[this.startY,this.endY]=[this.endY,t]:this.startY=t}resetBottom(t){t<this.startY?[this.startY,this.endY]=[t,this.startY]:this.endY=t}resetLeft(t){t>this.endX?[this.startX,this.endX]=[this.endX,t]:this.startX=t}resetRight(t){t<this.getStartX()?[this.startX,this.endX]=[t,this.startX]:this.endX=t}resetTopLeft(t,e){t>this.endX&&e>this.endY?[this.startX,this.startY,this.endX,this.endY]=[this.endX,this.endY,t,e]:t>this.endX?[this.startX,this.startY,this.endX,this.endY]=[this.endX,e,t,this.endY]:e>this.endY?[this.startX,this.startY,this.endX,this.endY]=[t,this.endY,this.startX,e]:[this.startX,this.startY]=[t,e]}resetTopRight(t,e){t<this.startX&&e>this.endY?[this.startX,this.startY,this.endX,this.endY]=[t,this.endY,this.startX,e]:t<this.startX?[this.startX,this.startY,this.endX,this.endY]=[t,e,this.startX,this.endY]:e>this.endY?[this.startX,this.startY,this.endX,this.endY]=[this.startX,this.endY,t,e]:[this.endX,this.startY]=[t,e]}resetBottomLeft(t,e){t>this.endX&&e<this.startY?[this.startX,this.startY,this.endX,this.endY]=[this.endX,e,t,this.startY]:e<this.startY?[this.startX,this.startY,this.endX,this.endY]=[t,e,this.endX,this.startY]:t>this.endX?[this.startX,this.startY,this.endX,this.endY]=[this.endX,this.startY,t,e]:[this.startX,this.endY]=[t,e]}resetBottomRight(t,e){t<this.startX&&e<this.startY?[this.startX,this.startY,this.endX,this.endY]=[t,e,this.startX,this.startY]:e<this.startY?[this.startX,this.startY,this.endX,this.endY]=[this.startX,e,t,this.endY]:t<this.startX?[this.startX,this.startY,this.endX,this.endY]=[t,this.startY,this.startX,e]:[this.endX,this.endY]=[t,e]}draw(t,e,n,s,r,i=[]){const{canvas:a}=this,o=a.getContext("2d");o.save(),o.strokeStyle="rgba(18,150,219,1)",o.lineWidth=2,o.lineJoin="round",o.clearRect(0,0,a.width,a.height),o.drawImage(r.image,0,0,a.width,a.height);const c=o.getImageData(0,0,a.width,a.height);for(let h=0;h<c.data.length;h+=4)c.data[h]*=.5,c.data[h+1]*=.5,c.data[h+2]*=.5;o.putImageData(c,0,0),o.drawImage(r.image,t,e,n,s,t,e,n,s),o.restore(),i.forEach((function(t){t()}))}mouseUpDraw(t){const{startX:e,startY:n,canvas:s}=this,r=this.getWidth(),i=this.getHeight();this.draw(e,n,r,i,t);const a=r/2+e,o=i/2+n,c=r+e,h=i+n;[[e,n],[a,n],[c,n],[c,o],[c,h],[a,h],[e,h],[e,o]].forEach((function([t,e]){!function(t,e,n,s,r="white"){if(!t)throw new Error("need imageInfo obj");const i=t.getContext("2d");i.beginPath(),i.arc(e,n,5,0,2*Math.PI),i.closePath(),i.fillStyle=r,i.fill()}(s,t,e)}))}mouseMoveDraw(t,e,n){const{startX:s,startY:r,endX:i,endY:a}=this,o=this.getCurrentLine();if(o)switch(o){case C:this.draw(s,e,i-s,a-e,n);break;case I:this.draw(s,r,i-s,e-r,n);break;case O:this.draw(t,r,i-t,a-r,n);break;case b:this.draw(s,r,t-s,a-r,n);break;case y:this.draw(t,e,i-t,a-e,n);break;case D:this.draw(s,e,t-s,a-e,n);break;case A:this.draw(t,r,i-t,e-r,n);break;case x:this.draw(s,r,t-s,e-r,n)}else this.draw(s,r,t-s,e-r,n)}}class F extends P{constructor(t={}){super(t);const{strokeStyle:e="#000"}=t;this.strokeStyle=e}mouseUpDraw(t){this.draw(this.startX,this.startY,this.getWidth(),this.getHeight(),t)}draw(t,e,n,s,r){const{canvas:i}=this,a=i.getContext("2d");a.save(),a.strokeStyle=this.getStrokeStyle(),a.lineWidth=this.getLineWidth(),a.lineJoin="round",a.strokeRect(t,e,n,s),a.restore()}}class j extends P{constructor(t){super(t);const{text:e=""}=t;this.text=e}setText(t){this.text=t}getText(){return this.text}draw(){const{canvas:t}=this,e=t.getContext("2d");e.save(),e.strokeStyle=this.getStrokeStyle(),e.strokeText(this.getText(),this.getStartX(),this.getStartY()+10),e.restore()}}class W extends P{constructor(t={}){super(t)}draw(t,e){const n=t.getContext("2d");n.save(),z(n,this.getStartX()-e,this.getStartY()-e,e,e),z(n,this.getStartX(),this.getStartY()-e,e,e),z(n,this.getStartX()-e,this.getStartY(),e,e),z(n,this.getStartX(),this.getStartY(),e,e),n.restore()}}function z(t,e,n,s,r){const i=t.getImageData(e,n,s,r),a=i.width,o=i.height,c=t.createImageData(s,r),h=10,d=a/h,l=o/h;for(let u=0;u<l;u++)for(let t=0;t<d;t++){const e=K(i,t*h,u*h);for(let n=0;n<h;n++)for(let s=0;s<h;s++)G(c,t*h+s,u*h+n,e)}t.putImageData(c,e,n)}function K(t,e,n){const s=t.width,r=[];return r[0]=t.data[4*(n*s+e)],r[1]=t.data[4*(n*s+e)+1],r[2]=t.data[4*(n*s+e)+2],r[3]=t.data[4*(n*s+e)+3],r}function G(t,e,n,s){const r=t.width;t.data[4*(n*r+e)]=s[0],t.data[4*(n*r+e)+1]=s[1],t.data[4*(n*r+e)+2]=s[2],t.data[4*(n*r+e)+3]=s[3]}let{warn:V,log:$}=console;V=function(){},$=function(){};const J=(t,e)=>{const n={title:t,content:e,duration:4500};h.open(n)};function q(){const t=a.useRef(null),e=a.useRef(null),[n,s]=a.useState(null),[r,h]=a.useState({x:0,y:0,colorArrayData:[]}),[d,l]=a.useState(new File([],"")),E=H((function(t,e){const{nativeEvent:{offsetX:n,offsetY:s}}=t,{w:r,h:i,imageData:a}=e;if(!a)return[];if(n>=1&&s>=1&&n*s<=r*i){const t=4*(s-1)*r+4*(n-1);return[a.data[t],a.data[t+1],a.data[t+2],a.data[t+3]]}}),0),[m,g]=a.useState(null),[p,_]=a.useState([]),[w,v]=a.useState([]),[C,I]=a.useState([]),[O,b]=a.useState([1,"#000"]),[y,D]=a.useState({type:N.INIT,moment:M.INIT,cursor:k()});function A(t,e){if(!e)throw new Error("no image file obj");if(!t)throw new Error("no canvas");let{w:n,h:s,image:r}=e;t.width=n,t.height=s;const i=t.getContext("2d");return i.drawImage(r,0,0,n,s),i.getImageData(0,0,n,s)}function x(t,e){return U(t,m.getStartX(),m.getEndX())&&U(e,m.getStartY(),m.getEndY())}a.useEffect((function(){e.current.width*=1,e.current.height*=1}),[e]),a.useEffect((function(){var t;d&&(t=URL.createObjectURL(d),new Promise(((e,n)=>{t||n();const s=new Image;s.src=t,s.onload=function(t){e({w:this.width,h:this.height,image:this,event:t})},s.onerror=n}))).then((function(t){D({type:N.INIT,moment:M.BEFORE_START,cursor:k()}),s(i(i({},t),{imageData:A(e.current,t)}))})).catch((function(t){return c.warning("加载图片失败，请刷新重试")}))}),[d]);const B=H((function(t){const{nativeEvent:{offsetX:n,offsetY:s}}=t,{type:i,moment:a}=y;if(i===N.PICK_COLOR)return function(t,e){let n=document.createElement("input");n.setAttribute("id","cp_hgz_input"),n.value=t,document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("cp_hgz_input").select(),document.execCommand("copy"),document.getElementById("cp_hgz_input").remove(),e&&e(t)}(r.colorArrayData.toString()),c.success("复制成功");if(i===N.SCREEN_SHOT&&[M.BEFORE_START,M.INIT].indexOf(a)>-1){const t=m.getCurActiveLine(n,s);t?(V(t),m.setCurrentLine(t),D({type:N.SCREEN_SHOT,moment:M.REGULATING,cursor:k(t)})):(m.setStartX(n),m.setStartY(s),D({type:N.SCREEN_SHOT,moment:M.STARTED,cursor:k(N.SCREEN_SHOT)}))}if(i===N.EDIT_RECT&&a===M.BEFORE_START){if(!x(n,s))return $("范围外");D({type:N.EDIT_RECT,moment:M.STARTED,cursor:k(N.EDIT_RECT)});const t=new F({startX:n,startY:s,canvas:e.current}),[r,i]=O;t.setLineWidth(r),t.setStrokeStyle(i),_([...p,t])}if(i===N.EDIT_TEXT){if(!x(n,s))return $("范围外");if(a===M.STARTED){w[w.length-1].draw()}const t=new j({startX:n,startY:s,canvas:e.current});D({type:N.EDIT_TEXT,moment:M.STARTED,cursor:k(N.EDIT_TEXT)}),v([...w,t])}if(i===N.ADD_MOSAIC){if(!x(n,s))return $("范围外");const t=new W({startX:n,startY:s,canvas:e.current});t.draw(t.canvas,10),I([...C,t]),D({type:N.ADD_MOSAIC,moment:M.STARTED,cursor:k(N.ADD_MOSAIC)})}}),0),z=H((function(t){const{nativeEvent:{offsetX:s,offsetY:r},pageX:a,pageY:o}=t,{width:c,height:d}=e.current,{type:l,moment:u}=y;if(l===N.PICK_COLOR){const e=E(t,n)||[];h({x:a+15,y:o+15,colorArrayData:e})}if(l===N.SCREEN_SHOT){if(u===M.BEFORE_START){if(!x(s,r)&&"crosshair"!==y.cursor)return D({type:N.SCREEN_SHOT,moment:M.BEFORE_START,cursor:k(N.SCREEN_SHOT)});const t=m.getCurActiveLine(s,r);t&&(V(t),D({type:N.SCREEN_SHOT,moment:M.BEFORE_START,cursor:k(t||N.SCREEN_SHOT)}))}if(u===M.STARTED&&m.mouseMoveDraw(s,r,n),u===M.REGULATING){if(!U(s,0,c)||!U(r,0,d)){let e={};return s<=0&&(e.offsetX=5),r<=0&&(e.offsetY=5),s>=c&&(e.offsetX=c-5),r>=d&&(e.offsetY=d-5),K(i(i({},t),{nativeEvent:e}))}m.mouseMoveDraw(s,r,n)}}if(l===N.EDIT_RECT){if([M.BEFORE_START].indexOf(u)>-1)return;if(u===M.STARTED){if(!x(s,r))return $("范围外");const t=p[p.length-1];m.draw(m.getStartX(),m.getStartY(),m.getWidth(),m.getHeight(),n,p.slice(0,p.length-1).map((function(t){return t.mouseUpDraw.bind(t,n)})).concat([t.mouseMoveDraw.bind(t,s,r,n)]).concat(w.map((function(t){return t.draw.bind(t)}))).concat(C.map((function(t){return t.draw.bind(t,t.canvas,10)}))))}}}),0),K=H((function(t){const{nativeEvent:{offsetX:e,offsetY:s}}=t;let{type:r,moment:i}=y;if(r===N.SCREEN_SHOT&&(i===M.STARTED&&(m.setEndX(e),m.setEndY(s),m.mouseUpDraw(n),D({type:N.SCREEN_SHOT,moment:M.BEFORE_START,cursor:k(N.SCREEN_SHOT)})),y.moment===M.REGULATING)){if(!m.mouseUpResetPos(e,s))return;m.mouseUpDraw(n),D({type:N.SCREEN_SHOT,moment:M.BEFORE_START,cursor:k(N.SCREEN_SHOT)})}if(r===N.EDIT_RECT){if(!x(e,s))return $("范围外");const t=p[p.length-1];if(!t)return $("no curEditRect");t.setEndX(e),t.setEndY(s),m.draw(m.getStartX(),m.getStartY(),m.getWidth(),m.getHeight(),n,p.map((function(t){return t.mouseUpDraw.bind(t,n)})).concat(w.map((function(t){return t.draw.bind(t)})).concat(C.map((function(t){return t.draw.bind(t,t.canvas,10)}))))),D({type:N.EDIT_RECT,moment:M.BEFORE_START,cursor:k(N.EDIT_RECT)})}if(r===N.ADD_MOSAIC){if(!x(e,s))return $("范围外");i===M.STARTED&&D({type:N.ADD_MOSAIC,moment:M.BEFORE_START,cursor:k(N.ADD_MOSAIC)})}}),0);const G={},{type:q,moment:Q}=y,Z=[N.SCREEN_SHOT,N.EDIT_TEXT,N.EDIT_RECT,N.ADD_MOSAIC].indexOf(q)>-1&&-1===[M.INIT].indexOf(Q),tt=q===N.EDIT_RECT,et=q===N.EDIT_TEXT;m&&Object.assign(G,{display:Z?"block":"none",x:m.getStartX()+m.canvas.offsetLeft,y:m.getEndY()+m.canvas.offsetTop,isEditingRect:tt,isEditingText:et});const nt={position:"absolute",transform:"translate3d(0,0,0)",backgroundColor:"transparent"},st=w.length,rt=q===N.EDIT_TEXT&&Q===M.STARTED;function it(){if(!n)return c.warning("请先选择图片");const{type:s}=y;if(s===N.INIT)return c.notice("请选定要截取的范围");if(s===N.PICK_COLOR)return c.notice("请点击要取色的区域");if(s===N.WATERMARK)return e.current.toBlob(at,"image/jpeg",1),c.success("复制成功");if(!m)return;let r=document.createElement("canvas");t.current.appendChild(r),r.width=m.getWidth(),r.height=m.getHeight();const i=r.getContext("2d"),a=e.current.getContext("2d").getImageData(m.getStartX(),m.getStartY(),m.getWidth(),m.getHeight());i.putImageData(a,0,0),r.toBlob(at,"image/jpeg",1),c.success("复制成功")}st&&Object.assign(nt,{display:rt?"block":"none",left:w[st-1].getStartX()+m.canvas.offsetLeft,top:w[st-1].getStartY()+m.canvas.offsetTop});const at=a.useCallback((t=>{const e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="test.jpg",n.click(),URL.revokeObjectURL(e)}),[]);return a.createElement("div",{className:[R.con].join(" "),onCopy:it,onContextMenu:function(t){t.preventDefault(),t.stopPropagation(),D({type:N.SCREEN_SHOT,moment:M.BEFORE_START,cursor:k(N.SCREEN_SHOT)}),_([]),v([]),L(e.current,n)}},a.createElement(u,{ref:t}),a.createElement(X,null,a.createElement(f,{handleInputChange:function(t){if(0===t.target.files.length)return;const[e]=t.target.files;l(e)}}),a.createElement(o,{className:R.btn,onClick:function(){if(!n)return c.warning("请先选择图片");L(e.current,n),D({type:N.PICK_COLOR,moment:M.BEFORE_START,cursor:k(N.PICK_COLOR)}),v([]),_([]),J("提示","点击要取色的地方即可取色")}},a.createElement("img",{src:"./assets/svgColorPicker.94e1f74a.svg",alt:"icon"}),"选择颜色"),a.createElement(o,{className:R.btn,onClick:function(){if(!n)return c.warning("请先选择图片");L(e.current,n),g(new P({startX:0,startY:0,endX:0,endY:0,canvas:e.current})),v([]),_([]),D({type:N.SCREEN_SHOT,moment:M.INIT,cursor:k(N.SCREEN_SHOT)}),J("提示","绘制完成可按ctrl + c下载图片")}},a.createElement("img",{src:"./assets/svgScreenShot.a21d9de1.svg",alt:"icon"}),"图片裁剪"),a.createElement(o,{className:R.btn,onClick:it},a.createElement("img",{src:"./assets/download.9d37c499.svg",alt:"icon"}),"点击下载"),a.createElement(o,{className:R.btn,onClick:function(){if(!n)return c.warning("请先选择图片");const{type:t}=y,s=e.current.getContext("2d"),{width:r,height:i}=e.current;t===N.WATERMARK&&(s.clearRect(0,0,r,i),s.drawImage(n.image,0,0,r,i));const a=prompt("请输入水印文字");if(!a)return c.warning("要输入文字");for(let e=-2*r;e<r;e+=~~(2*a.length*15))for(let t=0;t<2*i;t+=~~(i/4))s.rotate(-45*Math.PI/180),s.font="20px microsoft songti",s.fillStyle="rgba(0,0,0,0.2)",s.fillText(a,e,t),s.rotate(45*Math.PI/180);D({type:N.WATERMARK,moment:M.INIT,cursor:k()})}},"添加水印")),a.createElement("div",null,a.createElement(T,{style:{cursor:y.cursor},onMouseMove:z,onMouseDown:B,onMouseUp:K,ref:e}),a.createElement(Y,{style:G,onChangeLineWidth:function(t){b([t,O[1]])},onChangeStrokeStyle:function(t){b([O[0],t])},onEditRect:function(){D({type:N.EDIT_RECT,moment:M.BEFORE_START,cursor:k(N.EDIT_RECT)})},onEditText:function(){D({type:N.EDIT_TEXT,moment:M.BEFORE_START,cursor:k(N.EDIT_TEXT)})},onAddMosaic:function(){D({type:N.ADD_MOSAIC,moment:M.BEFORE_START,cursor:k(N.ADD_MOSAIC)})}})),null,y.type===N.PICK_COLOR?a.createElement(S,{position:r}):null,q===N.EDIT_TEXT?a.createElement("input",{className:R.editText,onChange:function(t){if(!w.length)return;w[w.length-1].setText(t.target.value)},style:nt}):null)}function Q(){return a.createElement("div",{className:"App"},a.createElement(q,null))}d.render(a.createElement(a.Fragment,null,a.createElement(Q,null)),document.getElementById("root"));
